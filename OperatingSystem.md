# 操作系统体系结构
## windows 体系结构
![](https://timgsa.baidu.com/timg?image&quality=80&size=b9999_10000&sec=1580922432250&di=97f6e939d0b376cd489116302b086770&imgtype=0&src=http%3A%2F%2F5b0988e595225.cdn.sohucs.com%2Fimages%2F20171119%2Fe9893df56b72442cb3de88b1f912065d.jpeg)

- (kernel)内核：线程 中断等
- ( win32)子系统
- Ntdll.dll 负责上面的用户态调用
![](https://i.loli.net/2020/02/05/SucrTsvq59n1VRj.png)

## unix 架构
![](https://ss0.bdstatic.com/70cFuHSh_Q1YnxGkpoWK1HF6hhy/it/u=828711790,4120883374&fm=26&gp=0.jpg)

## linux 内核组件
![](https://i.loli.net/2020/02/05/7Nm1R5IfsvnYPbd.png)

# 操作系统分类
## 传统分类
- 批处理操作系统
  - 单道
  - 多道
  - 一次执行多少道程序
  - spooling
    - 利用磁盘作为缓冲，将输入、计算、输出分别组织成独立的任务流，使I/O和计算真正并行
- 分时操作系统
  - 时间片
    - 操作系统将cpu时间划分为若干个片段，称为时间片
    - 以时间片为单位，轮流为每个终端用户吃梨
- 通用操作系统
  - 分时与批处理结合
- 实时操作系统
  - 及时响应外部事件的请求
  - 严格时间内要做响应
  - 高可靠性
- 个人计算机操作系统
  - 界面优化
  - 使用方便
- 网络操作系统
  - 网络管理 通信 安全
- 分布式操作系统
  - 以计算机网络为基础
  - 或多处理机为基础
  - 处理分布在不同计算机上
  - 是一个统一的操作系统
- 嵌入式操作系统
## Tenenbaum分类
- 智能卡操作系统
  - 严格运行能耗和储存空间的限制
  - 只有单项功能
# 操作系统运行环境 运行机制

## 系统调用机制
## 处理器状态（模式）
- 处理器由运算器 控制器 一系列的寄存器以及高速缓存构成
- 用户可见寄存器
  - 高级语言编译器通过优化算法分配并使用，以减少程序访问内存次数
- 控制和状态寄存器
  - 用于控制处理器的操作，通常有操作系统代码使用
  - 在某种特权级别下可以访问修改
  - 常见：
    - 程序计数器：记录将要取出的指令的地址
    - 指令寄存器：记录最近取出的指令
    - 程序状态字：记录CPU的运行状态与条件码，模式，控制位等信息
- 操作系统的需求--保护
  - 因为并发共享取用硬件，因此需要实现保护控制
  - 需要硬件提供基本运行机制
    - 能在不同的特权级运行的不同指令集合
    - 硬件机制可将os与用户程序隔离：操作系统可以访问用户空间，用户空间不可以访问操作系统空间
- 现代处理器通常将CPU状态设计划分为两种、三种或四种
- 在**程序状态字**中专门设置一位或两位，根据用户状态**对资源和指令的使用权限**进行设置不同的CPU状态
- 操作系统需要两个状态：用户态内核态
  - 特权指令 只能由操作系统使用，用户程序不能使用
  - 非特权指令 用户程序可以使用的指令
  - X86 4个特权级别：R0(内核态) R1 R2 R3（用户态）
## 中断与异常机制
  - 用户态进入内核态的唯一途径就是：**中断/异常/陷入机制**
  - 内核态进入用户态：**设置程序状态字PSW**
  - 特殊指令：陷入指令（又称访管指令 supervisor mode）
    - 提供给用户程序的接口，用于调用操作系统的功能（服务）
  - 主要作用
    - 处理设备发来的中断请求
    - 可以使os捕获用户程序提出的服务请求
    - 防止用户程序执行过程中的破坏性活动
  - 中断/异常 的概念
    - CPU对系统发生的**某个事件**做出的一种反应
      - CPU暂停正在执行的程序，保留现场后自动转去执行相应事件的处理程序，处理完成后返回断点继续执行被打断的程序
      - 特点：随机发生的 自动处理的 可恢复的 由硬件来完成
    - 中断的引入：为了支持CPU和设备之间的并行操作 （例如向CPU汇报IO完成）
    - 异常的引入：表示CPU执行指令时本身出现的问题
